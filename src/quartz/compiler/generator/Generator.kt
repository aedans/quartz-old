package quartz.compiler.generator

import quartz.compiler.generator.semantics.unwrapExpressions
import quartz.compiler.generator.semantics.verifyNames
import quartz.compiler.syntax.tree.ProgramNode
import quartz.compiler.visitor.plus
import java.io.OutputStream

/**
 * Created by Aedan Smith.
 */

object Generator {
    fun write(programNode: ProgramNode, outputStream: OutputStream) {
        val newProgramNode = ((ProgramNode::unwrapExpressions +
                ProgramNode::verifyNames)
        (programNode))
        val cStream = ProgramOutputStream(newProgramNode, outputStream)
        cStream.declare("header") {
            comment("Generated by the Quartz compiler")
            newline()
        }
        cStream.writeAll()
    }
}
